angular.module("ps-ui",["ps-ui.dashboard","ps-ui.multi-transclude","ps-ui.fc","ps-ui.in","ui.bootstrap","ui.utils"]),angular.module("ps-ui.dashboard",[]).directive("psSidebar",function(){return{restrict:"E",templateUrl:"template/dashboard/sidebar.html",transclude:!0,scope:{menu:"="},link:function(e){e.isSubmenu=function(e){return"submenu"===e.type},e.toggleSubmenu=function(e){"submenu"===e.type&&(e.open=!e.open)}}}}).directive("psToggleSidebar",function(){return{restrict:"E",templateUrl:"template/dashboard/toggle-sidebar.html",scope:{},link:function(e){e.toggle=function(){var e=angular.element(document.getElementById("ps-sidebar")),n=angular.element(document.getElementById("ps-content"));e.hasClass("show-sidebar")?(e.removeClass("show-sidebar"),n.removeClass("show-sidebar")):(e.addClass("show-sidebar"),n.addClass("show-sidebar"))}}}}).directive("psContent",function(){return{restrict:"E",templateUrl:"template/dashboard/content.html",transclude:!0}}),angular.module("ps-ui.fc",["ps-ui.fc.addresses","ps-ui.fc.codice-fiscale","ps-ui.fc.emails","ps-ui.fc.phones","ps-ui.fc.faxes","ps-ui.fc.tags"]),angular.module("ps-ui.in",["ps-ui.in.address","ps-ui.in.delete","ps-ui.in.tag"]),angular.module("ps-ui.multi-transclude",[]).directive("psMultiTransclude",function(){return{link:function(e,n,t,i,a){if(!a)throw new Error("Illegal use of psMultiTransculde");a(function(e){var i=angular.element("<div></div>");i.append(e);var a="[name="+t.psMultiTransclude+"]",s=i[0].querySelector(a);s=angular.element(s),n.replaceWith(s)})}}}),angular.module("ps-ui.fc.addresses",[]).directive("psFcAddresses",function(){return{restrict:"E",templateUrl:"template/fc/addresses/addresses.html",scope:{addresses:"=",options:"="},link:function(e){e.text={"delete":"Elimina",question:"Confermi l'eliminazione?",yes:"Sì",no:"No"},e.input="",e.addAddress=function(n){if(n instanceof KeyboardEvent){if(13!==n.keyCode)return;if(!e.place)return;if(!e.place.country)return}var t=e.place||{};t.street=t.street||e.input||"",t.number=t.number||"",t.postalCode=t.postalCode||"",t.city=t.city||"",t.county=t.county||"",t.country=t.country||"",e.addresses||(e.addresses=[]),e.addresses.push(t),e.place={},e.input=""},e.delAddress=function(n){e.addresses.splice(n,1)},e.oneLineAddress=function(e){var n="";return""!==e.street&&(n+=e.street,""!==e.number&&(n+=" "+e.number),n+=","),""!==e.city&&(n+=" "+e.city),""===n&&(n="Nuovo indirizzo"),n}}}}),angular.module("ps-ui.fc.codice-fiscale",["ui.utils"]).factory("PsCfConstants",function(){var e={};return e.months=["A","B","C","D","E","H","L","M","P","R","S","T"],e.odd={0:1,1:0,2:5,3:7,4:9,5:13,6:15,7:17,8:19,9:21,A:1,B:0,C:5,D:7,E:9,F:13,G:15,H:17,I:19,J:21,K:2,L:4,M:18,N:20,O:11,P:3,Q:6,R:8,S:12,T:14,U:16,V:10,W:22,X:25,Y:24,Z:23},e.even={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25},e.remaining=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],e}).factory("PsCfValidationService",["PsCfConstants",function(e){var n={};n.length=function(e){if(16!==e.length)throw new Error("Invalid length")},n.month=function(n){var t=n.slice(8,9);if(-1===e.months.indexOf(t))throw new Error("Invalid month")},n.day=function(n){var t=parseInt(n.slice(6,8),10)+1900,i=e.months.indexOf(n.slice(8,9))+1,a=parseInt(n.slice(9,11),10);a=a>41?a-40:a;var s=new Date(i+"-"+a+"-"+t);if(isNaN(s.valueOf()))throw new Error("Invalid day")},n.control=function(n){for(var t=0,i=0;15>i;i++)t+=i%2===0?e.odd[n[i]]:e.even[n[i]];var a=e.remaining[t%26];if(n[n.length-1]!==a)throw new Error("Invalid control digit. Should be "+a)};var t=function(e){e=e.toUpperCase();try{n.length(e),n.month(e),n.day(e),n.control(e)}catch(t){return console.log(t.message),!1}return!0};return{validate:t}}]).directive("psFcCodiceFiscale",["PsCfValidationService",function(e){return{restrict:"E",templateUrl:"template/fc/codice-fiscale/codice-fiscale.html",scope:{cf:"="},link:function(n,t){t.find("input").on("keyup",function(){n.$apply(function(){if(!n.cf)return void(n.invalidCf=!0);var t=e.validate(n.cf);n.invalidCf=!t,n.validCf=t})}),t.find("input").on("blur",function(){n.$apply(function(){n.cf||(n.invalidCf=!1),n.validCf=!1})})}}}]),angular.module("ps-ui.fc.emails",[]).directive("psFcEmails",function(){return{restrict:"E",templateUrl:"template/fc/emails/emails.html",scope:{emails:"="},link:function(e){e.text={"delete":"Elimina",question:"Confermi l'eliminazione?",yes:"Sì",no:"No"},e.addEmail=function(n){n instanceof KeyboardEvent&&13!==n.keyCode||e.newEmail&&""!==e.newEmail&&(e.emails||(e.emails=[]),e.emails.push({address:e.newEmail}),e.newEmail="")},e.delEmail=function(n){e.emails.splice(n,1)}}}}),angular.module("ps-ui.fc.faxes",[]).directive("psFcFaxes",function(){return{restrict:"E",templateUrl:"template/fc/faxes/faxes.html",scope:{faxes:"="},link:function(e){e.text={"delete":"Elimina",question:"Confermi l'eliminazione?",yes:"Sì",no:"No"},e.addFax=function(n){n instanceof KeyboardEvent&&13!==n.keyCode||e.newFax&&""!==e.newFax&&(e.faxes||(e.faxes=[]),e.faxes.push({number:e.newFax}),e.newFax="")},e.delFax=function(n){e.faxes.splice(n,1)}}}}),angular.module("ps-ui.fc.phones",[]).directive("psFcPhones",function(){return{restrict:"E",templateUrl:"template/fc/phones/phones.html",scope:{phones:"="},link:function(e){e.text={"delete":"Elimina",question:"Confermi l'eliminazione?",yes:"Sì",no:"No"},e.addPhone=function(n){n instanceof KeyboardEvent&&13!==n.keyCode||e.newPhone&&""!==e.newPhone&&(e.phones||(e.phones=[]),e.phones.push({number:e.newPhone}),e.newPhone="")},e.delPhone=function(n){e.phones.splice(n,1)}}}}),angular.module("ps-ui.fc.tags",[]).directive("psFcTags",function(){return{restrict:"E",templateUrl:"template/fc/tags/tags.html",scope:{tags:"="},link:function(e){e.noTags=function(){return e.tags?0===e.tags.length:!0}}}}),angular.module("ps-ui.in.address",[]).factory("PsPlaceFormattingService",[function(){var e=function(e,n){return-1!==e.indexOf(n)},n=function(n){var t={};return n.address_components.forEach(function(n){e(n.types,"route")?t.street=n.long_name:e(n.types,"street_number")?t.number=n.long_name:e(n.types,"locality")?t.city=n.long_name:e(n.types,"postal_code")?t.postalCode=n.long_name:e(n.types,"administrative_area_level_2")?t.county=n.short_name:e(n.types,"country")&&(t.country=n.long_name)}),t};return{format:n}}]).directive("psInAddress",["PsPlaceFormattingService",function(e){return{restrict:"E",replace:!0,templateUrl:"template/in/address/address.html",scope:{place:"=",input:"=",options:"=",placeholder:"@"},link:function(n,t){try{n.autocomplete=new google.maps.places.Autocomplete(t[0],n.options),google.maps.event.addListener(n.autocomplete,"place_changed",function(){n.$apply(function(){var t=n.autocomplete.getPlace();t&&t.address_components&&(t=e.format(t)),n.place=t})})}catch(i){return}}}}]),angular.module("ps-ui.in.delete",[]).directive("psInDelete",function(){return{restrict:"E",templateUrl:"template/in/delete/delete.html",scope:{deleteAction:"&",text:"="}}}),angular.module("ps-ui.in.tag",[]).directive("psInTag",function(){return{restrict:"E",templateUrl:"template/in/tag/tag.html",scope:{tags:"=",placeholder:"@"},link:function(e){e.delTag=function(n){e.tags.splice(n,1)},e.addingKeyCodes=[13,32,188,186],e.addTag=function(n){if(!(n instanceof KeyboardEvent&&-1===e.addingKeyCodes.indexOf(n.keyCode)||n instanceof MouseEvent&&0!==n.button||""===e.newTag)){var t=e.newTag.trim(),i=t[t.length-1];(","===i||";"===i)&&(t=t.slice(0,-1)),e.tags||(e.tags=[]),-1===e.tags.indexOf(t)&&e.tags.push(t),e.newTag=""}},e.noTags=function(){return e.tags?0===e.tags.length:!0}}}});